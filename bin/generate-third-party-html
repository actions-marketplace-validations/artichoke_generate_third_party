#!/usr/bin/env ruby
# frozen_string_literal: true

# avoid ugly stacks on permissible signals
Signal.trap('INT', 'SYSTEM_DEFAULT') if Signal.list.include?('INT')
Signal.trap('PIPE', 'SYSTEM_DEFAULT') if Signal.list.include?('PIPE')

require 'generate_third_party'

manifest_path = ARGV[0]
if manifest_path.nil? || !manifest_path.end_with?('Cargo.toml')
  warn "Error: Must pass path to `Cargo.toml` as first argument."
  exit 1
end

unless Artichoke::Generate::ThirdParty::CargoAbout.present?
  warn <<~ERR
    Error: `cargo-about` not found in PATH.

    Try installing `cargo-about` with:

        cargo install cargo-about

  ERR
  exit 1
end

puts Artichoke::Generate::ThirdParty::AllTargets.third_party_html(manifest_path)
